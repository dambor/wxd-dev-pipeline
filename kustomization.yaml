apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: wxd

# Helm chart configuration
helmCharts:
- name: wxd
  repo: https://github.com/dambor/wxd-dev-pipeline.git
  releaseName: wxd
  namespace: wxd
  version: "1.0.0"
  valuesInline:
    # Image configuration
    image:
      repository: ghcr.io/ibm-cis/wxd
      tag: latest
      pullPolicy: IfNotPresent

    # Replica count
    replicaCount: 1

    # Resources
    resources:
      limits:
        cpu: 2000m
        memory: 4Gi
      requests:
        cpu: 1000m
        memory: 2Gi

    # Service ports
    service:
      type: ClusterIP
      ports:
        console:
          port: 443
          targetPort: 443
        minio:
          port: 9001
          targetPort: 9001
        mds:
          port: 8381
          targetPort: 8381

    # Storage
    storage:
      enabled: true
      size: 100Gi
      storageClassName: standard

    # Security context
    securityContext:
      runAsNonRoot: true
      runAsUser: 1000
      fsGroup: 1000

# ConfigMaps for non-sensitive data
configMapGenerator:
- name: wxd-config
  literals:
  - NAMESPACE=wxd
  - LOG_LEVEL=INFO
  - MONITORING_ENABLED=true

# Secrets (reference external secret store)
secretGenerator:
- name: wxd-secrets
  envs:
  - secrets.env

# Common labels applied to all resources
commonLabels:
  app: wxd
  managed-by: kustomize

# Common annotations
commonAnnotations:
  description: "WXD (watsonx Data) deployment"
  version: "1.0.0"